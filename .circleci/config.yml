version: 2.1

executors:
  node:
    docker:
      - image: circleci/node:14.17.4
  node_test:
    docker:
      - image: circleci/node:14.17.4
        environment:
          TZ: "Asia/Saigon"

  java-node:
    docker:
      - image: cimg/node:14.15.0-browsers

jobs:
  run_tests:
    docker:
      - image: circleci/node:16
    steps:
      - checkout
      - run: 
          name: Install deps
          command: yarn install
workflow:
  build_test:
    jobs:
      DeployDEV:
        jobs:
          - build_and_test:
            filters:
              branches:
                only:
                  - main
          
          - deploy:
            name: DeployDev
            deploy_env: dev
            requires:
              - build_and_test
            filters:
              branches:
                only:
                  - main